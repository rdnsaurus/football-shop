{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block meta %}
  <title>London Is Red</title>
  <meta name="description" content="Your one-stop shop for all things Arsenal FC.">
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}

<div class="pt-16 h-screen bg-cover bg-center flex flex-col justify-center items-center bg-black bg-opacity-50" style="background-image: url('{% static 'images/wallpaper.jpg' %}')">
  <div class="max-w-7xl mx-auto p-4">
    <div class="flex justify-center">
      <div class="text-[antiquewhite] text-center">
        <h1 class="text-3xl font-bold mb-4">Welcome to LondonIsRed</h1>
        <p class="mb-4">Your one-stop shop for all things Arsenal FC. COME ON YOU GUNNERS!!!</p>
        <a href="#featured_products" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700">Shop Now</a>
      </div>
    </div>
    <div class="mt-4 text-center bg-opacity-50 bg-red-600 p-2 rounded xanimation">
      {% if user.is_authenticated %}
      <p class="text-white italic">Last login: {{ last_login }}</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- Featured Products -->
<div class="bg-white py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 id="featured_products" class="text-2xl font-bold mb-6 text-gray-800 text-center">Featured Products</h2>

    <!-- Loading -->
    <div id="loading" class="text-center py-4 hidden">
      <p class="text-gray-500 italic">Loading products...</p>
    </div>

    <!-- Error -->
    <div id="error" class="text-center py-4 hidden">
      <p class="text-red-500 font-semibold">Failed to load products. Please try again later.</p>
    </div>

    <!-- Empty State -->
    <div id="empty" class="text-center py-4 hidden">
      <img src="{% static 'images/noitems.jpg' %}" alt="No items available" class="mx-auto mb-4 w-32 h-32 opacity-50">
      <p class="text-gray-500 italic">No items available.</p>
    </div>

    <!-- Grid Container -->
    <div id="grid" class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
  </div>
</div>

<div class="bg-white py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 id="featured_products" class="text-2xl font-bold mb-6 text-gray-800 text-center">Aku Suka Tempe</h2>
      <div class="flex flex-wrap justify-center items-start gap-8">

        <!-- Tombol AJAX -->
        <div class="flex flex-col items-center space-y-2">
          <button onclick="showItemForm()"
            class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded shadow-md transition-all">
            Create (AJAX)
          </button>
          <p class="text-gray-600 text-sm text-center">Tambah item via AJAX</p>
        </div>

        <!-- Tombol Fetch Items -->
        <div class="flex flex-col items-center space-y-2">
          <button onclick="fetchItems()"
            class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded shadow-md transition-all">
            Fetch Items
          </button>
          <p class="text-gray-600 text-sm text-center">Ambil data item dari server</p>
        </div>

        <!-- Tombol Create Lama (Reload) -->
        <div class="flex flex-col items-center space-y-2">
          <a href="/create-item/"
            class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded shadow-md transition-all text-center">
            Create (Reload)
          </a>
          <p class="text-gray-600 text-sm text-center">Halaman form biasa (reload)</p>
        </div>

        <!-- Tombol Toast Test -->
        <div class="flex flex-col items-center space-y-2">
          <button onclick="document.dispatchEvent(new CustomEvent('testToast'))"
            class="bg-yellow-500 hover:bg-yellow-600 text-white px-5 py-2 rounded shadow-md transition-all">
            Test Toast
          </button>
          <p class="text-gray-600 text-sm text-center">Tampilkan notifikasi sukses</p>
        </div>

      </div>

  </div>
</div>
  
<div id="toast-1"
  class="z-50 fixed top-5 right-5 bg-green-200 text-green-700 px-4 py-2 rounded shadow-lg hidden transition-opacity duration-500">
  ðŸ«¡ Rispek wok!!!.
</div>

<div id="toast-2"
  class="z-50 fixed top-5 right-5 bg-red-500 text-white px-4 py-2 rounded shadow-lg hidden transition-opacity duration-500">
  ðŸ˜‚ Gagal cik!!!
</div>

<div id="toast-3"
  class="z-50 fixed top-5 right-5 bg-blue-400 text-white px-4 py-2 rounded shadow-lg hidden transition-opacity duration-500">
  ðŸ¥¶ UTSnya semoga 100!!!.
</div>


<!-- AJAX Script -->
<script src="{% static 'js/mainModal.js' %}"></script>
<script src="{% static 'js/createItemForm.js' %}"></script>
<script src="{% static 'js/editItemForm.js' %}"></script>
<script src="{% static 'js/deleteItem.js' %}"></script>
<script src="{% static 'js/detailItem.js' %}"></script>

<script>
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const URLS = {
    showJson: "{% url 'main:show_json' %}",
    showJsonById: "{% url 'main:show_json_by_id' '00000000-0000-0000-0000-000000000000' %}",
    createItem: "{% url 'main:add_item_entry_ajax' %}",
    editItem: "{% url 'main:edit_item' '00000000-0000-0000-0000-000000000000' %}",
    deleteItem: "{% url 'main:delete_item' '00000000-0000-0000-0000-000000000000' %}",
  };

  const CONFIG = {
    currentUser: "{{ user.username|escapejs }}",
    noImageUrl: "{% static 'images/noitems.jpg' %}",
  };

  document.addEventListener('DOMContentLoaded', function() {
    initItemDisplay(URLS.showJson);
    initModalHandlers(URLS.showJsonById, CONFIG.currentUser, CONFIG.noImageUrl);
    initDeleteHandler(URLS.deleteItem);
    initEditHandlers(URLS.editItem, URLS.showJsonById);
    initCreateItemHandler(URLS.createItem);

    const toast1 = document.getElementById("toast-1");
    const toast2 = document.getElementById("toast-2");
    const toast3 = document.getElementById("toast-3");

    const successEvents = ['itemAdded', 'itemEditted', 'itemDeleted'];
    const failEvents = ['itemAddedFailed', 'itemEdittedFailed', 'itemDeletedFailed'];

    successEvents.forEach(eventName => {
      document.addEventListener(eventName, () => showToast(toast1, 3000));
    });

    failEvents.forEach(eventName => {
      document.addEventListener(eventName, () => showToast(toast2, 3000));
    });

    document.addEventListener('testToast', () => showToast(toast3, 3000));
  });
</script>


{% include 'details.html' %}
{% include 'create_item_ajax.html' %}
{% include 'edit_item.html' %}

{% endblock content %}
